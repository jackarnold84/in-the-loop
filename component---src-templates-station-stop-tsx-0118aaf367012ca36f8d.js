"use strict";(self.webpackChunkin_the_loop=self.webpackChunkin_the_loop||[]).push([[185],{746:function(e,t,a){a.d(t,{A:function(){return x}});a(4129);var r=a(6951),n=(a(5123),a(8037)),l=(a(8601),a(9693)),o=(a(5298),a(4448)),s=a(3826),i=a(6540),c=a(2388),u=a(6565),m=a(2240),d=a(7379),p=a(8217),v=a(436),h=(a(9283),a(1442)),E=(a(8110),a(5884)),A=a(2632),w=a(4017),f=a(2118),g=a(8175);const y=[{dataIndex:"route",key:"route",width:75,render:(e,t)=>i.createElement(g.A,{type:t.transitType,route:e})},{dataIndex:["arrival","time"],key:"arrivalTime",width:150,render:e=>i.createElement(f.A,{dateStr:e})},{dataIndex:["arrival","time"],key:"timeUntilArrival",width:150,render:(e,t)=>i.createElement(A.A,{dateStr:e,isApproaching:t.arrival.isApproaching})}];var k=e=>{let{nextArrivals:t}=e;const[a,r]=i.useState([]),n=e=>{r((t=>t.includes(e.run)?t.filter((t=>t!==e.run)):[].concat((0,v.A)(t),[e.run])))};return i.createElement(h.A,{columns:y,dataSource:t,showHeader:!1,pagination:!1,rowKey:"run",expandable:{expandedRowRender:e=>(e=>{const t=[{dataIndex:"run",key:"run",width:75,render:e=>`#${e}`},{dataIndex:["departure","time"],key:"reachDestination",width:150,render:t=>e.departure?i.createElement("span",null,"Arrive ",i.createElement(f.A,{dateStr:t})):null},{key:"follow",width:150,render:()=>i.createElement(w.A,{to:`/follow?run=${e.run}`,state:{fromArrivals:!0}},i.createElement(E.A,{type:"link"},"Follow"))}],a=[{...e}];return i.createElement(h.A,{columns:t,dataSource:a,pagination:!1,showHeader:!1,size:"small",rowKey:"run"})})(e),rowExpandable:()=>!0,expandedRowKeys:a,onExpand:(e,t)=>{n(t)}},onRow:e=>({style:{cursor:"pointer"},onClick:()=>n(e)})})},b="track-module--dropdownLabel--52f22",S="track-module--fullWidth--6b8b4";async function I(e){const t=e.map((async e=>{let{transitType:t,routes:a,arrival:r,departure:n}=e;const l=a.join(","),o=new URL("https://9fqgf0uli3.execute-api.us-east-2.amazonaws.com/Prod/in-the-loop/track-arrivals");o.searchParams.set("transit",t),o.searchParams.set("routes",l),o.searchParams.set("arrival",r),n&&o.searchParams.set("departure",n);try{console.log(`fetch track-arrivals: ${t} ${l} ${r} to ${n}`);const e=await fetch(o);if(!e.ok){console.error(`HTTP error! status: ${e.status}`);const t=await e.json();console.error(`Error response: ${JSON.stringify(t,null,2)}`)}const a=(await e.json()).arrivals;return a.sort(((e,t)=>new Date(e.arrival.time).getTime()-new Date(t.arrival.time).getTime())),a}catch(s){throw console.error("Error fetching arrival data:",s),s}}));return{response:await Promise.all(t),lastUpdated:new Date}}const T=e=>!!e&&(new Date).getTime()-e.getTime()<3e4;var x=e=>{var t,a;let{tracks:v,title:h,subtitle:E,destinations:A,routeFilter:w}=e;const[f,g]=i.useState((null==A||null===(t=A[0])||void 0===t?void 0:t.stopId)||""),[y,x]=i.useState((null==w?void 0:w.map((e=>e.id)))||[]),[N,$]=i.useState(!1),[C,P]=i.useState(!0),D=v.map((e=>({transitType:e.transitType,routes:e.routes,arrival:e.stopId,departure:f||void 0}))),{data:R,error:L,isValidating:j,mutate:z}=(0,u.Ay)(D,I,{refreshInterval:15e3,keepPreviousData:!0}),H=null==R||null===(a=R.response)||void 0===a?void 0:a.map((e=>e.filter((e=>!w||y.includes(e.route))))),U=null==R?void 0:R.lastUpdated,_=H&&H.length>0&&H[0].length>0;i.useEffect((()=>{!j&&C&&P(!1)}),[j]),i.useEffect((()=>{$(T(U));const e=setInterval((()=>{$(T(U))}),1e3);return()=>clearInterval(e)}),[U]);return i.createElement(m.A,null,i.createElement(m.A,{bottom:16},i.createElement("div",{className:"track-module--titleContainer--61fce"},i.createElement(p.A,{size:0},i.createElement("h2",{className:"track-module--titleText--80672"},h),E&&i.createElement("div",null,E)),i.createElement(p.A,{left:10,right:0},i.createElement(d.A,{isLive:N,onClick:()=>{z()}})))),A&&A.length&&i.createElement(m.A,{bottom:16},i.createElement("label",{className:b},"Destination Stop:"),i.createElement(o.A,{id:"destination-select",className:S,value:f,onChange:e=>{g(e)}},A.map((e=>i.createElement(o.A.Option,{key:e.stopId,value:e.stopId},e.name))))),w&&w.length>1&&i.createElement(m.A,{bottom:16},i.createElement("label",{className:b},"Routes:"),i.createElement(o.A,{mode:"multiple",id:"route-filter-select",className:S,value:y,onChange:e=>{x(e)},optionLabelProp:"value",allowClear:!0,showArrow:!0,showSearch:!1},w.map((e=>i.createElement(o.A.Option,{key:e.id,value:e.id},e.name))))),L?i.createElement(m.A,null,i.createElement(l.Ay,{status:"warning",title:i.createElement("span",{className:"track-module--errorTitle--881d5"},"Something went wrong"),subTitle:"We were unable to retrieve live CTA tracking data",icon:i.createElement(s.A,{className:"track-module--warningIcon--17ea9"})})):C?i.createElement(m.A,null,i.createElement(n.A,{active:!0})):_?null==H?void 0:H.map(((e,t)=>{var a,r;return e.length>0&&i.createElement(m.A,{size:16,key:t},i.createElement("h4",{className:"track-module--alignLeft--1c4a8"},null===(a=e[0])||void 0===a||null===(r=a.arrival)||void 0===r?void 0:r.stopName),i.createElement(k,{nextArrivals:e}))})):i.createElement(m.A,null,i.createElement(r.A,{description:"No upcoming arrivals found",image:i.createElement(c.Bsn,{size:84})})))}},2030:function(e,t,a){a.r(t),a.d(t,{Head:function(){return c}});var r=a(6540),n=a(795),l=a(3224),o=a(2853),s=a(746);const i=e=>{if("bus"===e[0].type){return`${Array.from(new Set(e.map((e=>e.direction)))).join(", ")}bound`}{const t=Array.from(new Set(e.flatMap((e=>e.headsign)))).sort(((e,t)=>e.length-t.length));return`${t.slice(0,3).join(", ")}${t.length>3?", ...":""}`}};t.default=e=>{let{pageContext:t}=e;const a=t.stationId,c=l.R[a],u=t.stopId,m=c.stops[u].map((e=>l.A[e])),d={transitType:m[0].type,routes:m.map((e=>e.route)),stopId:m[0].stop},p=m.map((e=>({id:e.route,name:"bus"==e.type?`${e.route} - ${e.routeName}`:e.routeName}))),v=Array.from(new Map(p.map((e=>[e.id,e]))).values());return r.createElement(o.A,null,r.createElement(n.A,{paths:[{to:`/station/${a}`,text:"Select Stop"}]}),r.createElement(s.A,{tracks:[d],title:c.name,subtitle:i(m),routeFilter:v}))};const c=()=>r.createElement("title",null,"In The Loop")}}]);
//# sourceMappingURL=component---src-templates-station-stop-tsx-0118aaf367012ca36f8d.js.map