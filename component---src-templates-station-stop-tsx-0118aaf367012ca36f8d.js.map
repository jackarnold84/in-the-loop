{"version":3,"file":"component---src-templates-station-stop-tsx-0118aaf367012ca36f8d.js","mappings":"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","sources":["webpack://in-the-loop/./src/features/track/ArrivalsTable.tsx","webpack://in-the-loop/./src/features/track/track.module.css","webpack://in-the-loop/./src/features/track/trackApi.ts","webpack://in-the-loop/./src/features/track/Arrivals.tsx","webpack://in-the-loop/./src/templates/stationStop.tsx"],"sourcesContent":["import { Button, Table } from \"antd\";\nimport { ColumnType } from \"antd/lib/table\";\nimport * as React from \"react\";\nimport Countdown from \"../../components/Countdown\";\nimport Link from \"../../components/Link\";\nimport TimeDisplay from \"../../components/TimeDisplay\";\nimport TransitIcon from \"../../components/TransitIcon\";\nimport { Arrival, NextArrivals } from \"./trackApi\";\n\ntype ArrivalsTableProps = {\n  nextArrivals: NextArrivals;\n};\n\nconst columns: ColumnType<Arrival>[] = [\n  {\n    dataIndex: 'route',\n    key: 'route',\n    width: 75,\n    render: (text: string, record: Arrival) => (\n      <TransitIcon type={record.transitType} route={text} />\n    )\n  },\n  {\n    dataIndex: ['arrival', 'time'],\n    key: 'arrivalTime',\n    width: 150,\n    render: (text: string) => <TimeDisplay dateStr={text} />,\n  },\n  {\n    dataIndex: ['arrival', 'time'],\n    key: 'timeUntilArrival',\n    width: 150,\n    render: (text: string, record: Arrival) => (\n      <Countdown dateStr={text} isApproaching={record.arrival.isApproaching} />\n    ),\n  },\n];\n\nconst ArrivalsTable: React.FC<ArrivalsTableProps> = ({ nextArrivals }) => {\n  const [expandedRowKeys, setExpandedRowKeys] = React.useState<string[]>([]);\n\n  const expandedRowRender = (record: Arrival): React.ReactNode => {\n    const expandedColumns: ColumnType<Arrival>[] = [\n      {\n        dataIndex: 'run',\n        key: 'run',\n        width: 75,\n        render: (text: string) => `#${text}`,\n      },\n      {\n        dataIndex: ['departure', 'time'],\n        key: 'reachDestination',\n        width: 150,\n        render: (text: string) =>\n          record.departure ? (\n            <span>\n              Arrive <TimeDisplay dateStr={text} />\n            </span>\n          ) : null,\n      },\n      {\n        key: 'follow',\n        width: 150,\n        render: () => (\n          <Link to={`/follow?run=${record.run}`} state={{ fromArrivals: true }}>\n            <Button type=\"link\">\n              Follow\n            </Button>\n          </Link>\n        ),\n      },\n    ];\n\n    const expandedData = [{ ...record }];\n    return (\n      <Table\n        columns={expandedColumns}\n        dataSource={expandedData}\n        pagination={false}\n        showHeader={false}\n        size=\"small\"\n        rowKey=\"run\"\n      />\n    );\n  };\n\n  const handleRowClick = (record: Arrival): void => {\n    setExpandedRowKeys((prevKeys) =>\n      prevKeys.includes(record.run)\n        ? prevKeys.filter((key) => key !== record.run)\n        : [...prevKeys, record.run]\n    );\n  };\n\n  const handleExpand = (_: boolean, record: Arrival): void => {\n    handleRowClick(record);\n  };\n\n  return (\n    <Table\n      columns={columns}\n      dataSource={nextArrivals}\n      showHeader={false}\n      pagination={false}\n      rowKey=\"run\"\n      expandable={{\n        expandedRowRender: (record) => expandedRowRender(record),\n        rowExpandable: () => true,\n        expandedRowKeys: expandedRowKeys,\n        onExpand: handleExpand,\n      }}\n      onRow={(record) => ({\n        style: { cursor: 'pointer' },\n        onClick: () => handleRowClick(record),\n      })}\n    />\n  );\n};\n\nexport default ArrivalsTable;\n","// extracted by mini-css-extract-plugin\nexport var alignLeft = \"track-module--alignLeft--1c4a8\";\nexport var dropdownLabel = \"track-module--dropdownLabel--52f22\";\nexport var errorTitle = \"track-module--errorTitle--881d5\";\nexport var fullWidth = \"track-module--fullWidth--6b8b4\";\nexport var titleContainer = \"track-module--titleContainer--61fce\";\nexport var titleText = \"track-module--titleText--80672\";\nexport var warningIcon = \"track-module--warningIcon--17ea9\";","const endpointUrl = \"https://9fqgf0uli3.execute-api.us-east-2.amazonaws.com/Prod/in-the-loop\";\n\nexport interface Arrival {\n  arrival: {\n    time: string;\n    stopName?: string;\n    isApproaching?: boolean;\n  };\n  departure?: {\n    time: string;\n  };\n  run: string;\n  route: string;\n  transitType: 'train' | 'bus';\n}\n\nexport type NextArrivals = Arrival[];\n\ninterface TrackArrivalsRequest {\n  transitType: string;\n  routes: string[];\n  arrival: string;\n  departure?: string;\n}\n\nexport async function trackArrivalsFetcher(\n  trackReqs: TrackArrivalsRequest[]\n): Promise<{ response: NextArrivals[], lastUpdated: Date }> {\n  const fetchPromises = trackReqs.map(async ({ transitType, routes, arrival, departure }) => {\n    const routesParam = routes.join(',');\n    const url = new URL(`${endpointUrl}/track-arrivals`);\n    url.searchParams.set('transit', transitType);\n    url.searchParams.set('routes', routesParam);\n    url.searchParams.set('arrival', arrival);\n    departure && url.searchParams.set('departure', departure);\n\n    try {\n      console.log(`fetch track-arrivals: ${transitType} ${routesParam} ${arrival} to ${departure}`);\n      const response = await fetch(url);\n      if (!response.ok) {\n        console.error(`HTTP error! status: ${response.status}`);\n        const data = await response.json();\n        console.error(`Error response: ${JSON.stringify(data, null, 2)}`);\n      }\n      const data = await response.json();\n      const arrivals: NextArrivals = data.arrivals;\n      arrivals.sort((a, b) => new Date(a.arrival.time).getTime() - new Date(b.arrival.time).getTime());\n      return arrivals;\n    } catch (error) {\n      console.error(\"Error fetching arrival data:\", error);\n      throw error;\n    }\n  });\n\n  const nextArrivalsList = await Promise.all(fetchPromises);\n  return { response: nextArrivalsList, lastUpdated: new Date() };\n}\n","import { WarningFilled } from \"@ant-design/icons\";\nimport { Empty, Result, Select, Skeleton } from \"antd\";\nimport * as React from \"react\";\nimport { GiParkBench } from \"react-icons/gi\";\nimport useSWR from \"swr\";\nimport Container from \"../../components/Container\";\nimport Live from \"../../components/Live\";\nimport Span from \"../../components/Span\";\nimport { Destination, TransitOption } from \"../../config/catalog\";\nimport ArrivalsTable from \"./ArrivalsTable\";\nimport * as styles from \"./track.module.css\";\nimport { trackArrivalsFetcher } from \"./trackApi\";\n\nconst REFRESH_INTERVAL = 15000;\nconst LIVE_THRESHOLD = 30000;\n\nconst isRecentUpdate = (lastUpdated: Date | undefined) => {\n  return !!lastUpdated && (new Date().getTime() - lastUpdated.getTime()) < LIVE_THRESHOLD;\n}\n\ntype Route = {\n  id: string;\n  name: string;\n}\n\ntype ArrivalsProps = {\n  tracks: TransitOption[];\n  title: string;\n  subtitle?: string;\n  destinations?: Destination[];\n  routeFilter?: Route[];\n};\n\nconst Arrivals: React.FC<ArrivalsProps> = ({ tracks, title, subtitle, destinations, routeFilter }) => {\n  const [selectedDestination, setSelectedDestination] = React.useState(destinations?.[0]?.stopId || '');\n  const [selectedRoutes, setSelectedRoutes] = React.useState(routeFilter?.map(route => route.id) || []);\n  const [isLive, setIsLive] = React.useState(false);\n  const [isFirstLoad, setIsFirstLoad] = React.useState(true);\n\n  const trackReqs = tracks.map(track => ({\n    transitType: track.transitType,\n    routes: track.routes,\n    arrival: track.stopId,\n    departure: selectedDestination || undefined,\n  }));\n\n  const { data, error, isValidating, mutate } = useSWR(trackReqs, trackArrivalsFetcher, {\n    refreshInterval: REFRESH_INTERVAL,\n    keepPreviousData: true,\n  });\n\n  const nextArrivalsList = data?.response?.map(arrivalData =>\n    arrivalData.filter(arrival =>\n      !routeFilter || selectedRoutes.includes(arrival.route)\n    )\n  );\n\n  const lastUpdated = data?.lastUpdated;\n  const hasArrivals = nextArrivalsList && nextArrivalsList.length > 0 && nextArrivalsList[0].length > 0;\n\n  React.useEffect(() => {\n    if (!isValidating && isFirstLoad) {\n      setIsFirstLoad(false);\n    }\n  }, [isValidating]);\n\n  // live data indicator\n  React.useEffect(() => {\n    setIsLive(isRecentUpdate(lastUpdated));\n    const intervalId = setInterval(() => {\n      setIsLive(isRecentUpdate(lastUpdated));\n    }, 1000);\n\n    return () => clearInterval(intervalId);\n  }, [lastUpdated]);\n\n  const handleLiveClick = () => {\n    mutate();\n  };\n\n  const handleDestinationChange = (value: string) => {\n    setSelectedDestination(value);\n  };\n\n  const handleRouteFilterChange = (selectedRoutes: string[]) => {\n    setSelectedRoutes(selectedRoutes);\n  };\n\n  return (\n    <Container>\n      <Container bottom={16}>\n        <div className={styles.titleContainer}>\n          <Span size={0}>\n            <h2 className={styles.titleText}>{title}</h2>\n            {subtitle && <div>{subtitle}</div>}\n          </Span>\n          <Span left={10} right={0}>\n            <Live isLive={isLive} onClick={handleLiveClick} />\n          </Span>\n        </div>\n      </Container>\n\n      {destinations && destinations.length && (\n        <Container bottom={16}>\n          <label className={styles.dropdownLabel}>Destination Stop:</label>\n          <Select\n            id=\"destination-select\"\n            className={styles.fullWidth}\n            value={selectedDestination}\n            onChange={handleDestinationChange}\n          >\n            {destinations.map((destination) => (\n              <Select.Option key={destination.stopId} value={destination.stopId}>\n                {destination.name}\n              </Select.Option>\n            ))}\n          </Select>\n        </Container>\n      )}\n\n      {routeFilter && routeFilter.length > 1 && (\n        <Container bottom={16}>\n          <label className={styles.dropdownLabel}>Routes:</label>\n          <Select\n            mode=\"multiple\"\n            id=\"route-filter-select\"\n            className={styles.fullWidth}\n            value={selectedRoutes}\n            onChange={handleRouteFilterChange}\n            optionLabelProp=\"value\"\n            allowClear showArrow showSearch={false}\n          >\n            {routeFilter.map(route => (\n              <Select.Option key={route.id} value={route.id}>\n                {route.name}\n              </Select.Option>\n            ))}\n          </Select>\n        </Container>\n      )}\n\n      {error ? (\n        <Container>\n          <Result\n            status=\"warning\"\n            title={\n              <span className={styles.errorTitle}>Something went wrong</span>\n            }\n            subTitle=\"We were unable to retrieve live CTA tracking data\"\n            icon={\n              <WarningFilled className={styles.warningIcon} />\n            }\n          />\n        </Container>\n\n      ) : isFirstLoad ? (\n        <Container>\n          <Skeleton active />\n        </Container>\n\n      ) : !hasArrivals ? (\n        <Container>\n          <Empty description=\"No upcoming arrivals found\" image={<GiParkBench size={84} />} />\n        </Container>\n\n      ) : (\n        nextArrivalsList?.map((arrivalData, index) => (\n          arrivalData.length > 0 && (\n            <Container size={16} key={index}>\n              <h4 className={styles.alignLeft}>{arrivalData[0]?.arrival?.stopName}</h4>\n              <ArrivalsTable nextArrivals={arrivalData} />\n            </Container>\n          )\n        ))\n      )}\n    </Container>\n  );\n};\n\nexport default Arrivals;\n","import * as React from \"react\";\nimport BackButton from \"../components/BackButton\";\nimport { stationIndex, Track, trackIndex } from \"../config/index\";\nimport Layout from \"../features/layout/Layout\";\nimport Arrivals from \"../features/track/Arrivals\";\n\ntype PageContext = {\n  stationId: string;\n  stopId: string;\n};\n\nconst getDirectionText = (tracks: Track[]) => {\n  if (tracks[0].type === \"bus\") {\n    const uniqueDirections = Array.from(new Set(tracks.map(track => track.direction)));\n    return `${uniqueDirections.join(\", \")}bound`;\n  } else {\n    const uniqueHeadsigns = Array.from(\n      new Set(tracks.flatMap(track => track.headsign))\n    ).sort((a, b) => a.length - b.length);\n    return `${uniqueHeadsigns.slice(0, 3).join(\", \")}${uniqueHeadsigns.length > 3 ? \", ...\" : \"\"}`;\n  }\n}\n\nconst StationStopTrackPage = ({ pageContext }: { pageContext: PageContext }) => {\n  const stationId = pageContext.stationId;\n  const station = stationIndex[stationId];\n  const stopId = pageContext.stopId;\n  const trackIdList = station.stops[stopId];\n  const tracks = trackIdList.map(trackId => trackIndex[trackId]);\n\n  const trackInput = {\n    transitType: tracks[0].type as 'train' | 'bus',\n    routes: tracks.map(track => track.route),\n    stopId: tracks[0].stop,\n  }\n  const routes = tracks.map(track => ({\n    id: track.route,\n    name: track.type == \"bus\" ? `${track.route} - ${track.routeName}` : track.routeName,\n  }));\n  const uniqueRoutes = Array.from(\n    new Map(routes.map(item => [item.id, item])).values()\n  );\n\n  return (\n    <Layout>\n      <BackButton paths={[{ to: `/station/${stationId}`, text: \"Select Stop\" }]} />\n      <Arrivals\n        tracks={[trackInput]}\n        title={station.name}\n        subtitle={getDirectionText(tracks)}\n        routeFilter={uniqueRoutes}\n      />\n    </Layout>\n  );\n};\n\nexport default StationStopTrackPage;\n\nexport const Head = () => <title>In The Loop</title>\n"],"names":["columns","dataIndex","key","width","render","text","record","React","TransitIcon","type","transitType","route","TimeDisplay","dateStr","Countdown","isApproaching","arrival","_ref","nextArrivals","expandedRowKeys","setExpandedRowKeys","handleRowClick","prevKeys","includes","run","filter","dataSource","showHeader","pagination","rowKey","expandable","expandedRowRender","expandedColumns","departure","Link","to","state","fromArrivals","expandedData","size","rowExpandable","onExpand","handleExpand","_","onRow","style","cursor","onClick","dropdownLabel","fullWidth","async","trackArrivalsFetcher","trackReqs","fetchPromises","map","routes","routesParam","join","url","URL","searchParams","set","console","log","response","fetch","ok","error","status","data","json","JSON","stringify","arrivals","sort","a","b","Date","time","getTime","Promise","all","lastUpdated","isRecentUpdate","tracks","title","subtitle","destinations","routeFilter","selectedDestination","setSelectedDestination","_destinations$","stopId","selectedRoutes","setSelectedRoutes","id","isLive","setIsLive","isFirstLoad","setIsFirstLoad","track","undefined","isValidating","mutate","useSWR","refreshInterval","keepPreviousData","nextArrivalsList","_data$response","arrivalData","hasArrivals","length","intervalId","setInterval","clearInterval","Container","bottom","className","Span","left","right","Live","handleLiveClick","styles","value","onChange","destination","Option","name","mode","optionLabelProp","allowClear","showArrow","showSearch","subTitle","icon","WarningFilled","active","index","_arrivalData$","_arrivalData$$arrival","stopName","ArrivalsTable","description","image","GiParkBench","getDirectionText","Array","from","Set","direction","uniqueHeadsigns","flatMap","headsign","slice","pageContext","stationId","station","stationIndex","stops","trackId","trackIndex","trackInput","stop","routeName","uniqueRoutes","Map","item","values","Layout","BackButton","paths","Arrivals","Head"],"sourceRoot":""}