"use strict";(self.webpackChunkin_the_loop=self.webpackChunkin_the_loop||[]).push([[680],{1980:function(e,t,n){n.r(t),n.d(t,{Head:function(){return k},default:function(){return N}});var r=n(6462),l=n(6540),o=n(795),a=(n(5134),n(3565)),i=n(5268),s=n(8027),c=n(2240),u=n(9941),d=(n(9283),n(1442)),m=(n(4129),n(6951)),p=(n(5123),n(8037)),f=(n(8601),n(9693)),h=n(2388),w=n(6565),g=n(2632),E=n(7379),v=n(8217),b=n(2118),A=n(8175);async function y(e){const{run:t,transitType:n}=e,r=new URL("https://9fqgf0uli3.execute-api.us-east-2.amazonaws.com/Prod/in-the-loop/follow-vehicle");r.searchParams.set("run",t),r.searchParams.set("transit",n);try{console.log(`fetch follow-vehicle: ${n} run ${t}`);const e=await fetch(r);if(!e.ok){console.error(`HTTP error! status: ${e.status}`);const t=await e.json();throw console.error(`Error response: ${JSON.stringify(t,null,2)}`),new Error(`HTTP error! status: ${e.status}`)}const l=await e.json();return console.log("Follow vehicle API response:",l),{response:l.follow,lastUpdated:new Date}}catch(l){throw console.error("Error fetching follow vehicle data:",l),l}}const x=e=>!!e&&(new Date).getTime()-e.getTime()<3e4,T=[{title:"Stop",dataIndex:"stopName",key:"stopName",width:"50%"},{title:"Arrival Time",dataIndex:"time",key:"time",width:"25%",render:e=>l.createElement(b.A,{dateStr:e})},{title:"Countdown",dataIndex:"time",key:"countdown",width:"25%",render:(e,t)=>l.createElement(g.A,{dateStr:e,isApproaching:t.isApproaching})}];var I=e=>{let{runNumber:t,transitType:n}=e;const[r,o]=l.useState(!1),[a,i]=l.useState(!0),{data:u,error:g,isValidating:b,mutate:I}=(0,w.Ay)(t?{run:t,transitType:n}:null,y,{refreshInterval:15e3,keepPreviousData:!0}),S=null==u?void 0:u.response,L=null==u?void 0:u.lastUpdated,N=(null==S?void 0:S.arrivals)&&S.arrivals.length>0;l.useEffect((()=>{console.log("=== FollowResults Debug ==="),console.log("data:",u),console.log("vehicleData:",S),console.log("hasArrivals:",N),console.log("arrivals array:",null==S?void 0:S.arrivals),console.log("isValidating:",b),console.log("isFirstLoad:",a),console.log("error:",g)}),[u,S,N,b,a,g]),l.useEffect((()=>{!b&&a&&i(!1)}),[b]),l.useEffect((()=>{o(x(L));const e=setInterval((()=>{o(x(L))}),1e3);return()=>clearInterval(e)}),[L]);return t?l.createElement(c.A,null,g?l.createElement(c.A,null,l.createElement(f.Ay,{status:"warning",title:l.createElement("span",{className:"follow-module--errorTitle--62620"},"No Results"),subTitle:"We were unable to follow that vehicle",icon:l.createElement(s._Hm,{className:"follow-module--errorIcon--ea243"})})):a?l.createElement(c.A,null,l.createElement(p.A,{active:!0})):N?l.createElement(l.Fragment,null,l.createElement(c.A,{bottom:16},l.createElement("div",{className:"follow-module--titleContainer--ed088"},l.createElement(v.A,{size:0},l.createElement("h2",{className:"follow-module--titleText--bfb9f"},l.createElement(A.A,{type:S.transitType,route:S.route}),l.createElement("span",{className:"follow-module--runNumber--5d263"},"Run #",S.run)),l.createElement("div",null,"train"===S.transitType?l.createElement(l.Fragment,null,S.route,S.destination&&` to ${S.destination}`):l.createElement(l.Fragment,null,S.route," Bus",S.destination&&` to ${S.destination}`,S.direction&&` (${S.direction})`))),l.createElement(v.A,{left:10,right:0},l.createElement(E.A,{isLive:r,onClick:()=>{I()}})))),l.createElement(c.A,null,l.createElement("h4",{className:"follow-module--alignLeft--579c3"},"Upcoming Stops"),l.createElement(d.A,{columns:T,dataSource:S.arrivals,pagination:!1,rowKey:e=>e.stopId,size:"middle",showHeader:!1}))):l.createElement(c.A,null,l.createElement(m.A,{description:"No vehicle found with this run number",image:l.createElement(h.Bsn,{size:84})}))):null};var S=e=>{let{showSearch:t=!0}=e;const n=(0,r.useLocation)(),o=new URLSearchParams(n.search).get("run")||"",[d,m]=l.useState(o),[p,f]=l.useState(o),h=d&&d.length>3?"bus":"train";l.useEffect((()=>{const e=new URLSearchParams(n.search).get("run")||"";m(e),f(e)}),[n.search]);return l.createElement(c.A,{width:600},t&&l.createElement(c.A,null,l.createElement(a.A.Search,{placeholder:"Enter run number",value:p,size:"large",allowClear:!0,autoFocus:!0,onSearch:e=>{const{formattedRun:t}=(e=>{const t=e.replace(/\D/g,"");return 0===t.length?{transitType:"train",formattedRun:""}:t.length<=3?{transitType:"train",formattedRun:t.padStart(3,"0")}:{transitType:"bus",formattedRun:t}})(e);t?(0,i.navigate)(`/follow?run=${encodeURIComponent(t)}`):(0,i.navigate)("/follow")},onChange:e=>{const t=e.target.value.replace(/\D/g,"");f(t)}})),l.createElement(c.A,{size:16},""===d?l.createElement(u.A,{description:"Enter a train or bus run number to follow its location",icon:l.createElement(s.$Fg,null)}):l.createElement(I,{runNumber:d,transitType:h})))},L=n(2853);var N=()=>{const e=(0,r.useLocation)().state,t=null==e?void 0:e.fromArrivals,n=null==e?void 0:e.source;return l.createElement(L.A,null,t&&n&&l.createElement(o.A,{paths:[{to:n,text:"Back to Stop"}]}),l.createElement(S,{showSearch:!t}))};const k=()=>l.createElement("title",null,"In The Loop - Follow Vehicle")},2240:function(e,t,n){const r=(0,n(7581).default)("div").withConfig({shouldForwardProp:e=>!["centered","flex","top","bottom","size","width"].includes(e)}).attrs((e=>{let{size:t=8,top:n,bottom:r,width:l,centered:o=!1,flex:a=!1}=e;return{size:t,top:null!=n?n:t,bottom:null!=r?r:t,width:l,centered:o,flex:a}})).withConfig({displayName:"Container",componentId:"sc-1la7ue3-0"})(["margin:auto;padding-top:","px;padding-bottom:","px;"," "," ",""],(e=>e.top),(e=>e.bottom),(e=>{let{width:t}=e;return t&&`\n    max-width: ${t}px;\n  `}),(e=>{let{centered:t}=e;return t&&"\n    text-align: center;\n    justify-content: center;\n  "}),(e=>{let{flex:t}=e;return t&&"\n    display: flex;\n  "}));t.A=r},8175:function(e,t,n){var r=n(6540),l=n(9197),o=n(7581),a=n(8490);const i=o.default.span.withConfig({displayName:"TransitIcon__BusIcon",componentId:"sc-1qjz7rx-0"})(["display:inline-block;background-color:",";color:white;padding:0px 2px;border-radius:4px;font-weight:600;text-align:center;min-width:24px;"],a.M.bus),s=(0,o.default)(l.b2D).withConfig({displayName:"TransitIcon__TrainIcon",componentId:"sc-1qjz7rx-1"})(["vertical-align:middle;font-size:20px;"]);t.A=e=>{let{type:t,route:n}=e;return"bus"===t?r.createElement(i,null,n):r.createElement("span",null,r.createElement(s,{color:(0,a.y)(n)}))}},8490:function(e,t,n){n.d(t,{M:function(){return r},y:function(){return l}});const r={primary:"#2166b1",bus:"#0b67be",alertRed:"#db0000"},l=e=>({Red:"#c60c30","Red Line":"#c60c30",Blue:"#00a1de","Blue Line":"#00a1de",Brown:"#62361b","Brown Line":"#62361b",Green:"#009b3a","Green Line":"#009b3a",Orange:"#f9461c","Orange Line":"#f9461c",Pink:"#e27ea6","Pink Line":"#e27ea6",Purple:"#522398","Purple Line":"#522398",Yellow:"#f9e300","Yellow Line":"#f9e300"}[e]||"#000000")},9941:function(e,t,n){n(4129);var r=n(6951),l=n(6540);t.A=e=>{let{description:t,icon:n}=e;const o=l.cloneElement(n,{color:"#d9d9d9",size:84});return l.createElement(r.A,{description:t,image:o})}}}]);
//# sourceMappingURL=component---src-pages-follow-tsx-04433b7cb05b8ddf3efb.js.map